<h1 id="stencil-">Stencil 路由</h1>
<p><code>@stencil/router</code> 是 NPM 上的一个路由的包，可以被用于 Stencil apps 内。</p>
<p>路由的开发体验被设计为和 <a href="https://reacttraining.com/react-router/">React Router</a> 相似，并且使其构建从非常简单到非常复杂所有规模的 app 都变得容易。</p>
<h2 id="-">安装</h2>
<p>在你的项目文件夹中，运行 <code>npm install @stencil/router</code>。</p>
<h2 id="-stencil-config-collection">添加到 Stencil Config Collection</h2>
<p>首先，确保 <code>stencil.config.js</code> 中的 <code>collections</code> 入口有 <code>@stencil/router</code> 包。如果没有的话，手动添加它。</p>
<p>打开项目的 <code>stencil.config.js</code> 文件，查看 <code>config</code> 导出项。</p>
<p>如下，添加一个对象到 <code>collections</code> 数组中，name 为 <code>@stencil/router</code>，若果没有的话。</p>
<pre><code class="lang-js">exports.config = {
  publicPath: <span class="hljs-string">'/build'</span>,
  bundles: [
    { components: [<span class="hljs-string">'stencil-site'</span>, <span class="hljs-string">'site-header'</span>, <span class="hljs-string">'landing-page'</span>] },
    { components: [<span class="hljs-string">'app-marked'</span>, <span class="hljs-string">'site-menu'</span>] },
    { components: [<span class="hljs-string">'demos-page'</span>, <span class="hljs-string">'document-component'</span>] }
  ],
  collections: [{ name: <span class="hljs-string">'@stencil/router'</span> }]
};
</code></pre>
<h2 id="-">包含的组件</h2>
<ul>
<li><p><strong>stencil-router</strong></p>
<p>在你的项目里，你应该只有单一的一个 stencil-router 组件。该组建控制着所有的和浏览器历史的交互，并且处理来自事件系统的更新。</p>
</li>
<li><p><strong>stencil-route</strong></p>
<p>这个组件根据当前路径是否匹配所提供的url，来决定是否渲染。</p>
<p><em>properties</em>:</p>
<ul>
<li><strong>url</strong> (<em>Array || string</em>): 需要匹配的路径。也可以传递一个数组，这样路由就可以匹配多个路径。可接受的路径于 expressjs 相似，所以你可以在 url 中定义参数如 <code>/foo/:bar</code> 这样你就能使用 bar 这个参数了。</li>
<li><strong>component</strong> (<em>string</em>):需要被渲染的组件。</li>
<li><strong>componentProps</strong> (<em>key/value Object</em>): 对象构成的键值对 (<code>{ &#39;red&#39;: true, &#39;blue&#39;: &#39;white&#39;}</code>) 将被作为属性传递给定义好的需要渲染的组件。</li>
<li><strong>routeRender</strong> (<em>function</em>): 一个接受 props 作为参数的函数。如果这一项存在，它将被用来决定放置什么组件。</li>
<li><strong>exact</strong> (<em>boolean</em>): 如果该值为 true 那么只有 url 严格匹配路径才会渲染。</li>
</ul>
</li>
<li><p><strong>stencil-route-link</strong></p>
<p>该组件被用来渲染定义好对路由链接。当它匹配当前路径时，会应用特定的样式。</p>
<p><em>properties</em>:</p>
<ul>
<li><strong>url</strong> (<em>string</em>): 链接指向对路径。</li>
<li><strong>exact</strong> (<em>boolean</em>): 如果该值为 true，仅当 url 严格匹配当前路径才会应用样式。</li>
<li><strong>activeClass</strong> (<em>string</em>): 当链接于当前路径匹配时，所使用的 class 值，默认是 &#39;link-active&#39;。</li>
</ul>
</li>
<li><p><strong>stencil-route-redirect</strong></p>
<p>该组件重定向当前的路径。</p>
<p><em>properties</em>:</p>
<ul>
<li><strong>url</strong> (<em>string</em>): 重定向的目标 url。</li>
</ul>
</li>
</ul>
<h2 id="-">配置路由</h2>
<p>Stencil 构建的应用，整个应用应该只有一个 <code>stencil-router</code> 元素。确保在它上边声明一个 <code>id</code> 属性。</p>
<pre><code><span class="hljs-tag">&lt;<span class="hljs-name">stencil-router</span>&gt;</span>
...
<span class="hljs-tag">&lt;/<span class="hljs-name">stencil-router</span>&gt;</span>
</code></pre><p>在 <code>stencil-router</code> 元素内, 我们想定义我们的 <code>stencil-route</code> 集合. 每一个 <code>stencil-route</code> 需要引用一个路由，一个 url，和一个 Html元素的标签名。</p>
<pre><code class="lang-jsx"><span class="hljs-tag">&lt;<span class="hljs-name">stencil-router</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">stencil-route</span> <span class="hljs-attr">url</span>=<span class="hljs-string">"/"</span> <span class="hljs-attr">component</span>=<span class="hljs-string">"landing-page"</span> <span class="hljs-attr">exact</span>=<span class="hljs-string">{true}/</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">stencil-route</span> <span class="hljs-attr">url</span>=<span class="hljs-string">"/demos"</span> <span class="hljs-attr">component</span>=<span class="hljs-string">"demos-page"</span>/&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">stencil-route</span> <span class="hljs-attr">url</span>=<span class="hljs-string">"/demos/rendering"</span> <span class="hljs-attr">component</span>=<span class="hljs-string">"fiber-demo"</span>/&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">stencil-route</span> <span class="hljs-attr">url</span>=<span class="hljs-string">"/docs"</span> <span class="hljs-attr">component</span>=<span class="hljs-string">"docs"</span>/&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">stencil-route</span> <span class="hljs-attr">url</span>=<span class="hljs-string">"/docs/getting-started"</span> <span class="hljs-attr">component</span>=<span class="hljs-string">"getting-started"</span>/&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">stencil-route</span> <span class="hljs-attr">url</span>=<span class="hljs-string">"/components"</span> <span class="hljs-attr">component</span>=<span class="hljs-string">"basics-components"</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">stencil-router</span>&gt;</span>
</code></pre>
<p>根据上边的配置，当导航到 <code>/demos/rendering</code> 时，<code>demos-page</code> 组件会被载入，并且有一个 <code>fiber-demo</code> 子组件。它们都会作为相关的 stencil-routes 的孩子被载入，但是它们互相之间没有关系。嵌套路由/组件同样起作用。</p>
<h2 id="-">导航</h2>
<p>要在 app 里导航，使用 <code>stencil-route-link</code> 组件。</p>
<pre><code class="lang-jsx">&lt;stencil-route-link <span class="hljs-attribute">url</span>=<span class="hljs-string">"/"</span>&gt;
&lt;stencil-route-link <span class="hljs-attribute">url</span>=<span class="hljs-string">"/demos"</span>&gt;
&lt;stencil-route-link <span class="hljs-attribute">url</span>=<span class="hljs-string">"/docs/getting-started"</span>&gt;
</code></pre>
<p>如果你想以编程的方式导航，首先你需要将路由历史作为属性传入你的组件。以下是一个示例：</p>
<pre><code class="lang-ts"><span class="hljs-keyword">import</span> { RouterHistory } <span class="hljs-keyword">from</span> <span class="hljs-string">'@stencil/router'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">askPage</span> {</span>
  @Prop() history: RouterHistory;
}
</code></pre>
<p>你可以在 history 对象上使用 <code>push</code> 方法来导航到一个新的页面：</p>
<pre><code class="lang-ts"><span class="hljs-selector-tag">this</span><span class="hljs-selector-class">.history</span><span class="hljs-selector-class">.push</span>(<span class="hljs-built_in">`/demos`</span>, {});
</code></pre>
<h2 id="url-">URL 参数</h2>
<p>你可能对 <a href="https://reacttraining.com/react-router/web/example/url-params">React Router</a> 中的 URL 参数的概念熟悉。URL 参数允许你向组件传递来自路由的数据。要在 Stencil 实现，我们首先需要设置我们的路由，让其接受参数。这里有一个例子：</p>
<pre><code class="lang-jsx"> &lt;stencil-route <span class="hljs-attribute">url</span>=<span class="hljs-string">'/show/:pageNum'</span> <span class="hljs-attribute">component</span>=<span class="hljs-string">'show-page'</span> /&gt;
</code></pre>
<p>路由中的关键部分是 <code>:pageNum</code> 语法。这意味着现在我们可以从传递参数给路由，并且数据会保存到 <code>pageNum</code> 变量中。以下是一个如何传递这个数据的例子：</p>
<pre><code class="lang-jsx">&lt;stencil-route-link <span class="hljs-built_in">url</span>={<span class="hljs-string">`/show/<span class="hljs-subst">${someData}</span>`</span>} /&gt;
</code></pre>
<p>现在我们看看如何访问来自 <code>show-page</code> 组件的数据。</p>
<p>首先，我们需要传递 <code>match</code> 参数到我们的 <code>show-page</code> 组件：</p>
<pre><code class="lang-ts"><span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ShowPage</span> {</span>
  @Prop() match: any;
}
</code></pre>
<p>然后我们可以通过使用 <code>match</code> 属性来访问我们的数据：</p>
<pre><code class="lang-ts"><span class="hljs-comment">// myData 就是我们在我们的 stencil-route-link 组件中传入的数据</span>
const myData = this<span class="hljs-selector-class">.match</span><span class="hljs-selector-class">.params</span><span class="hljs-selector-class">.pageNum</span>
</code></pre>
<p><stencil-route-link url="/stencil-site/docs/angular-integration" router="#router" custom="true">
  <button class="backButton">
    返回
  </button>
</stencil-route-link></p>
